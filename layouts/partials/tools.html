<div class="page-tools">
  <div class="font-controls">
    <strong>
    <button onclick="changeFontSize(1)">A+</button>
    <button onclick="changeFontSize(-1)">A-</button>
    <button onclick="resetFontSize()">A</button>
    <button onclick="printSelected()">Drukuj</button>
    </strong>
  </div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  // znajdź przycisk drukowania
  const printBtn = document.querySelector('.font-controls button[onclick="printSelected()"]');
  if (!printBtn) return;

  // ukryj go domyślnie
  printBtn.style.display = 'none';

  // pokaż tylko jeśli istnieje <article class="print-area">
  if (document.querySelector('article.print-area')) {
    printBtn.style.display = 'inline-block';
  }
});
</script>


<script>
function printSelected() {
  const area = document.querySelector('.print-area');
  if (!area) return;

  const bodyFontSize = window.getComputedStyle(document.body).fontSize;
  const pageTitle = "{{ .Title }}";

  const newWin = window.open('', '', 'width=800,height=600');
  const doc = newWin.document;

  doc.write('<html><head><title>' + pageTitle + '</title></head><body></body></html>');
  doc.close();

  // skopiuj style
  const styles = document.querySelectorAll('link[rel="stylesheet"], style');
  let pending = 0;

  styles.forEach(el => {
    const clone = el.cloneNode(true);

    if (clone.tagName === "LINK") {
      pending++;
      clone.onload = () => {
        pending--;
        if (pending === 0) finish();
      };
      clone.onerror = () => {
        pending--;
        if (pending === 0) finish();
      };
    }

    doc.head.appendChild(clone);
  });

  // własny styl font-size
  const style = doc.createElement('style');
  style.textContent = `body { font-size: ${bodyFontSize}; }`;
  doc.head.appendChild(style);

  // zawartość
  doc.body.innerHTML = `<h1>${pageTitle}</h1>${area.outerHTML}`;

  function finish() {
    newWin.focus();
    newWin.print();   // tu powinno od razu otworzyć okno wyboru drukarki
    newWin.close();
  }

  // jeśli nie było <link>, wywołaj od razu
  if (pending === 0) finish();
}
</script>

<script>
let defaultSize = 12;
let currentSize = localStorage.getItem("fontSize") 
                 ? parseInt(localStorage.getItem("fontSize")) 
                 : defaultSize;

document.body.style.fontSize = currentSize + "px";

function changeFontSize(step) {
  currentSize += step;
  document.body.style.fontSize = currentSize + "px";
  localStorage.setItem("fontSize", currentSize);
}

function resetFontSize() {
  currentSize = defaultSize;
  document.body.style.fontSize = currentSize + "px";
  localStorage.setItem("fontSize", currentSize);
}

</script>
